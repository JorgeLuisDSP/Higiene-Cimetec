<div class="dashboard-container">
   <header class="dashboard-header">
      <h1>Painel de Controle</h1>

      <div class="filter-section">
         <h2>Filtrar Tarefas</h2>
         <div class="filter-buttons">
            <button *ngFor="let filter of taskFilters" class="filter-btn" [class.active]="activeFilter === filter.value"
               (click)="setActiveFilter(filter.value)">
               {{ filter.label }}
            </button>
            <button class="refresh-btn" (click)="refreshTasks()">
               <i class="fa-solid fa-refresh"></i> Atualizar
            </button>
         </div>
      </div>
   </header>

   <main class="dashboard-content">
      <section class="stats-section">
         <div class="stat-card">
            <h3>Tarefas Pendentes</h3>
            <p class="stat-number">12</p>
         </div>

         <div class="stat-card">
            <h3>Em Andamento</h3>
            <p class="stat-number">8</p>
         </div>

         <div class="stat-card">
            <h3>Resolvidas</h3>
            <p class="stat-number">24</p>
         </div>

         <div class="stat-card">
            <h3>Total</h3>
            <p class="stat-number">44</p>
         </div>
      </section>

      <section class="tasks-section">
         <h2>Tarefas {{ activeFilter }}</h2>

         <div *ngIf="error" class="error-message">
            <p>{{ error }}</p>
         </div>

         <div class="tasks-list" *ngIf="tasks$ | async as tasks; else loading">
            <div class="task-item" *ngFor="let task of tasks">
               <div class="task-header">
                  <h4>{{ task.title || 'Tarefa de Limpeza' }}</h4>
                  <span class="task-status" [ngClass]="{
              'pending': task.status === 'Pendente',
              'in-progress': task.status === 'Em Andamento',
              'completed': task.status === 'Resolvida'
            }">{{ task.status || 'Sem status' }}</span>
               </div>

               <div class="task-details">
                  <div class="task-row">
                     <span class="label">RA:</span>
                     <span class="value">{{ task.ra || 'Não informado' }}</span>
                  </div>

                  <div class="task-row">
                     <span class="label">Localização:</span>
                     <span class="value">{{ task.location || 'Não informado' }}</span>
                  </div>

                  <div class="task-row">
                     <span class="label">Data/Hora:</span>
                     <span class="value">{{ task.dateTime || 'Não informado' }}</span>
                  </div>
                  <div>
                     <div class="task-row">
                        <i class="bi bi-exclamation-diamond"></i>
                        <span class="label">Itens Faltando:</span>
                     </div>
                     <div class="task-tags" *ngIf="task.tags && task.tags.length > 0">
                        <span class="tag" *ngFor="let tag of task.tags">{{ tag }}</span>
                     </div>
                  </div>

                  <div class="task-row">
                     <span class="label">Observação:</span>
                     <span class="value">{{ task.observation || 'Nenhuma observação' }}</span>
                  </div>
               </div>

               <div class="task-footer">
                  <div class="status-update">
                     <label for="status-select-{{task.id}}">Atualizar Status:</label>
                     <select id="status-select-{{task.id}}" class="status-select"
                        (change)="updateTaskStatus(task.id, $event)" [value]="task.status">
                        <option value="Pendente">Pendente</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Resolvida">Resolvido</option>
                     </select>
                  </div>
               </div>
            </div>

            <div *ngIf="tasks.length === 0 && !error" class="no-tasks">
               <p>Nenhuma tarefa encontrada.</p>
            </div>
         </div>

         <ng-template #loading>
            <div class="loading">
               <p>Carregando tarefas...</p>
            </div>
         </ng-template>
      </section>
   </main>
</div>